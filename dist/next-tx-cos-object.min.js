/*!
 * name: @feizheng/next-tx-cos-object
 * description: Tencent cos object for next.
 * homepage: https://github.com/afeiship/next-tx-cos-object
 * version: 1.0.1
 * date: 2020-04-30T16:22:18.999Z
 * license: MIT
 */
!function(){var e=e||this||window||Function("return this")(),u=e.nx||require("@feizheng/next-js-core2"),t=require("cos-nodejs-sdk-v5"),n=require("bluebird"),i={SecretId:"COS_SECRETID",SecretKey:"COS_SECRETKEY"},s={del:"deleteObjectAsync",dels:"deleteMultipleObjectAsync"},o=u.declare("nx.TxCosObject",{methods:{init:function(e){this.options=u.mix(null,i,e),this.cos=new t(this.options),n.promisifyAll(this.cos,{context:this.cos})},"put,del,dels":function(t){return function(e){return this.parseOptions(e),this.cos[s[t]||t+"ObjectAsync"](e)}},empty:function(o){var c=this;return this.parseOptions(o),new n(function(i,s){c.cos.getBucketAsync(o).then(function(e){var t=e.Contents.map(function(e){return{Key:e.Key}}),n=u.mix(null,o,{Objects:t});c.dels(n).then(function(e){i(e)}).catch(function(e){s(e)})}).catch(function(e){s(e)})})},parseOptions:function(e){if(e){var t=this.options.id,n=e.Bucket;n&&(e.Bucket=n.includes(t)?n:n+"-"+t)}}}});"undefined"!=typeof module&&module.exports&&(module.exports=o)}();